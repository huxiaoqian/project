{% extends "propagate/base.html" %}
{% block title %}单条微博传播分析{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='css/propagate/microblog.css') }}" rel="stylesheet">
<style>
  .WB_feed_datail, .WB_feed_type {
    width: 500px;
  }
  .WB_info, .WB_text, .WB_detail {
    width: 450px;
  }
  .WB_detail {
    margin-left: 50px;
  }
  #count_chart_first {
    float:left;
    width: 49%;
  }
  #count_chart_second {
    float:right;
    width: 49%;
  }
</style>
{% endblock %}
{% block content %}
  <div class="container-fluid">
    <div class="row-fluid">        
      <div class="span12">
        <div class="caption" style="float:left">
          <div style="float:left">
            {% if tar_profile_image_url %}
            <img style="width: 150px; height: 140px;" type="image/jpg" src="{{ tar_profile_image_url }}" media="screen" >
            {% else %}
            <img style="width: 150px; height: 140px;" type="image/jpg" src="/static/img/topic_none.png" media="screen" />
            {% endif %}
          </div>
          <div style="float:left;padding-left:50px;width:1000px;">
            <h3>单条微博传播分析</h3>
            <label style="font-size:18px;float:left;">发起人：<span class="badge badge-success" style="font-size:18px"> {{ tar_screen_name }} </span> </label>
            <label class="appendedInput" style="font-size:18px;padding-left:30px;float:left;">发布时间：{{ tar_post_date }} </label>
            <label class="appendedInput" style="font-size:18px;padding-left:500px;">微博链接：<a href="{{weibo_url}}">{{ weibo_url }} </a></label>           
            <label class="appendedInput" style="font-size:18px;padding-top:10px;">内容：{{ tar_text }} </label>
        </div>        
      </div>
    </div><!--上侧信息-->

    <div class="row-fluid" style="padding-top:20px;">
      <div class="span12" id="index-tabs" style="padding-top:20px;">
        <ul class="nav nav-pills tab_container">
          <li class="btn span2 btn-primary" style="width:150px;height:20px;"><a href="/propagate/single_ajax_weibos/?mid={{mid}}" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">关联微博</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/propagate/single_ajax_trend/?mid={{mid}}" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">传播数量走势</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/propagate/single_ajax_spatial/?mid={{mid}}" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">地理分布</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/propagate/single_ajax_stat/?mid={{mid}}" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">传播指标</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/propagate/single_ajax_userfield/?mid={{mid}}" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">关键人员统计</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/gexf/show_graph/{{mid}}/sub" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">传播路径(子树)</a></li>
          <li class="btn span2" style="width:150px;height:20px;"><a href="/gexf/show_graph/{{mid}}/whole" align="center" style="padding-top: 2px;padding-bottom: 2px;color:black;">传播路径(全树)</a></li>          
        </ul>
        <div id="content_container">
          <div class="well" style="height:1000px">
            <div id="count_chart_first">
              <legend style="text-align:center;">全树相关微博</legend>
              {% if not blog_info %}
                <p>计算结果为空</p>
              {% endif %}
              {% for status in blog_info %}
              <div class="WB_feed_type SW_fun  S_line2">
                <div class="WB_feed_datail S_line2 clearfix">
                  <div class="WB_face">
                    <a class="W_face_radius"><img alt="" width="50" height="50" src="{{ status['user']['profile_image_url'] }}"></a>
                  </div>
                  <div class="WB_detail">
                    <div class="WB_info"><a class="WB_name S_func1"> {{ status['user']['name'] }} </a>
                    </div>
                    <div class="WB_text" node-type="feed_list_content">{{ status['status']['text'] }}</div>
                    <div class="WB_func clearfix">
                      <div class="WB_handle">
                        <a><em class="W_ico20 icon_praised_b"></em>赞:{{ status['status']['attitudes_count'] }}</a><i class="S_txt3">|</i>
                        <a>转发:{{ status['status']['reposts_count'] }}</a><i class="S_txt3">|</i>
                        <a>评论:{{ status['status']['comments_count'] }}</a><i class="S_txt3">|</i>
                        <em class="S_txt2">来自</em><a class="S_link2" >{{ status['status']['source'] }}</a>  
                      </div>
                      <div class="WB_from">
                        <a class="S_link2 WB_time" id="weibo_time{{ status['status']['_id'] }}">{{ status['status']['created_at'] }}</a>                                  
                      </div>
                      <div class="WB_handle">
                        <a href="/propagate/?mid={{ status['status']['_id'] }}&time={{ status['status']['created_at'] }}" style="color:#FF8000;" target='_blank'>分析</a><i class="S_txt3">|</i>
                        <a id="ma{{ status['status']['_id'] }}" name ="{{ status['status']['_id'] }}" style="color:red;">导入素材库</a>
                      <script>

                        $("#ma{{ status['status']['_id'] }}").click(function () {
                          var id=this.getAttribute("name");
                          var ori_mid='{{mid}}';
                          $.ajax({   
                              type:"POST",  
                              url:"/propagate/add_material",
                              dataType: "json",
                              async:false,
                              data:{mid : id, ori_mid : ori_mid, flag: 0},
                              success: function(data){
                                  if(data == 'Right') {
                                      alert("导入成功！");
                                  }
                                  else{
                                      if(data == 'Wrong'){
                                        alert("该微博已在素材库中！");
                                      }
                                      else{
                                        alert("未找到该微博！");
                                      }
                                  } 
                              }              
                          });
                        });
                      </script>
                      </div>
                    </div>
                    <div node-type="feed_list_repeat" class="WB_media_expand repeat S_line1 S_bg4" style="display:none;"></div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
            <div id="count_chart_second">
              <legend style="text-align:center;">子树的相关微博</legend>
              {% if not blog_info_part %}
                <p>计算结果为空</p>
              {% endif %}
              {% for status in blog_info_part %}
              <div class="WB_feed_type SW_fun  S_line2">
                <div class="WB_feed_datail S_line2 clearfix">
                  <div class="WB_face">
                    <a class="W_face_radius"><img alt="" width="50" height="50" src="{{ status['user']['profile_image_url'] }}"></a>
                  </div>
                  <div class="WB_detail">
                    <div class="WB_info"><a class="WB_name S_func1"> {{ status['user']['name'] }} </a>
                    </div>
                    <div class="WB_text" node-type="feed_list_content">{{ status['status']['text'] }}</div>
                    <div class="WB_func clearfix">
                      <div class="WB_handle">
                        <a><em class="W_ico20 icon_praised_b"></em>赞:{{ status['status']['attitudes_count'] }}</a><i class="S_txt3">|</i>
                        <a>转发:{{ status['status']['reposts_count'] }}</a><i class="S_txt3">|</i>
                        <a>评论:{{ status['status']['comments_count'] }}</a><i class="S_txt3">|</i>
                        <em class="S_txt2">来自</em><a class="S_link2" >{{ status['status']['source'] }}</a> 
                      </div>
                      <div class="WB_from">
                        <a class="S_link2 WB_time" id="weibo_time{{ status['status']['_id'] }}">{{ status['status']['created_at'] }}</a>                                   
                      </div>
                      <div class="WB_handle">
                        <a href="/propagate/?mid={{ status['status']['_id'] }}&time={{ status['status']['created_at'] }}" style="color:#FF8000;" target='_blank'>分析</a><i class="S_txt3">|</i>
                        <a id="ma{{ status['status']['_id'] }}" name ="{{ status['status']['_id'] }}" style="color:red;">导入素材库</a>
                        <script>
                          $("#ma{{ status['status']['_id'] }}").click(function () {
                              var id=this.getAttribute("name");
                              var ori_mid='{{mid}}';
                              $.ajax({   
                                  type:"POST",  
                                  url:"/propagate/add_material",
                                  dataType: "json",
                                  async:false,
                                  data:{mid : id, ori_mid : ori_mid, flag: 1},
                                  success: function(data){
                                      if(data == 'Right') {
                                          alert("导入成功！");
                                      }
                                      else{
                                        if(data == 'Wrong'){
                                          alert("该微博已在素材库中！");
                                        }
                                        else{
                                          alert("未找到该微博！");
                                        }
                                      } 
                                  }              
                              });
                          });
                        </script>
                      </div>
                    </div>
                    <div node-type="feed_list_repeat" class="WB_media_expand repeat S_line1 S_bg4" style="display:none;"></div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock %}
{% block script %}
  <script src="/static/js/jquery-ui.js"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/highstock.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/exporting.js') }}"></script>
{% endblock script %}