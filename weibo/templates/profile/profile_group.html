{% extends "profile/base.html" %}
{% block head %}
  <style>
    body{
      padding-top: 60px;
    }
  </style>
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/datarangepiker.css') }}">
  <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/datepicker.css') }}">
{% endblock head%}
{% block content %}
  <script src="/static/js/profile/raphael.js"></script>
  <script src="/static/js/profile/chinamap.js"></script>
  <script src="/static/js/profile/RGraph.common.core.js"></script>
  <script src="/static/js/profile/RGraph.pie.js"></script>
  <script src="/static/js/profile/RGraph.common.dynamic.js"></script>

  <script src="/static/js/profile/d3.v3.min.js"></script>
  <script src="/static/js/profile/d3.layout.cloud.js"></script>
  <script src="/static/js/profile/rgbcolor.js"></script> 
  <script src="/static/js/profile/StackBlur.js"></script>
  <script src="/static/js/profile/canvg.js"></script>

  <script src="{{ url_for('static', filename='js/identify/moment.js') }}"></script>
  <script src="{{ url_for('static', filename='js/identify/datarangepiker.js') }}"></script>
  <script src="{{ url_for('static', filename='js/identify/bootstrap-datepicker.js') }}"></script>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span2 well" style="padding: 8px 0;">
        <ul class="nav nav-list">
          {% for fielden, fieldzh in field_dict.iteritems() %}
            {% if atfield == fieldzh %}
               <li class="active"><a href="/profile/group/?fieldEnName={{ fielden }}">{{ fieldzh }}</a></li>
            {% else %}
               <li><a href="/profile/group/?fieldEnName={{ fielden }}">{{ fieldzh }}</a></li>
            {% endif %}            
          {% endfor %}
        </ul>
      </div>

      <div class="span9">
        <legend>{{fieldzh}}领域</legend>
        <form id="profile_group_form" action="/profile/group/" class="form-inline" method="GET">
            <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>领域:</b></font>
            <div class="btn-group">
              <a id="area_rank_method_choosen" class="btn dropdown-toggle" data-toggle="dropdown" href="javascript:void(0);">{{ field_zh }}<span class="caret"></span></a>
              <ul id="area_rank_method_dropdown_menu" class="dropdown-menu">
                {% for fielden, fieldzh in field_dict.iteritems() %}
                    <li><a href="#" onClick="choose_field('area', '{{ fielden }}');" data-toggle="tab">{{ fieldzh }}</a></li>
                {% endfor %}
              </ul>
            </div>
            <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>&nbsp&nbsp&nbsp时间范围:</b></font>
            <div id="field_window_size_choosen" class="btn dropdown-toggle" href="#">
              <i class="icon-calendar icon-large"></i>
              <span id="field_date">{{ timerange }}</span> 
              <b class="caret"></b>
            </div>
            <input id="field_hidden" type="hidden" name="fieldEnName" value="{{ field_en }}">
            <input id="during_time" type="hidden" name="during_time" value="{{ timerange }}">
            &nbsp&nbsp&nbsp
            <input type="submit" class="btn btn-primary" onclick="submit_search_profile_group();return false;" value="分析">
          </form>
        <ul class="nav nav-pills tab_container">
          <li class="btn span2 btn-primary" id="tab1">话题兴趣</li>
          <li class="btn span2" id="tab2">认证及地理分布</li>
          <li class="btn span2" id="tab3">微博数量走势</li>
          <li class="btn span2" id="tab4">重要度走势</li>
        </ul>
        <div id="content_container"></div>
      </div>

    </div><!--row-fluid-->
  </div><!--container-fluid-->
{% endblock content %}
{% block script %}
  <script src="{{ url_for('static', filename='js/date_parameter.js') }}"></script>
  <script>
    var start_ts = '{{ start_ts }}';
    var end_ts = '{{ end_ts }}';

    $('#content_container').empty();
    $('#content_container').load("/profile/person_tab_ajax/grouptopic/{{model}}?start_ts=" + start_ts + "&end_ts=" + end_ts, function() {});

    tabIdArr = ['tab1', 'tab2', 'tab3', 'tab4'];
    tabUrlArr = ["/profile/person_tab_ajax/grouptopic/{{model}}?start_ts=" + start_ts + "&end_ts=" + end_ts, "/profile/person_tab_ajax/grouplocation/{{model}}?start_ts=" + start_ts + "&end_ts=" + end_ts, "/profile/person_tab_ajax/groupweibocount/{{model}}?start_ts=" + start_ts + "&end_ts=" + end_ts, "/profile/person_tab_ajax/groupimportant/{{model}}?start_ts=" + start_ts + "&end_ts=" + end_ts];
    for (var i = 0, len = tabIdArr.length; i < len; i++) {
      document.getElementById(tabIdArr[i]).onclick = function(data) {
        var tabId = data.srcElement.id;
        var tabIdx = parseInt(tabId.substring(3, 4));
        $('#content_container').empty();
        for (var j = 0, len = tabIdArr.length; j < len; j++){
          if(j != tabIdx - 1){
            $("#" + tabIdArr[j]).removeClass('btn-primary');
          }
        }
        $("#" + tabId).addClass('btn-primary');
        $('#content_container').load(tabUrlArr[tabIdx - 1], function() {});
      }
    }

    function submit_search_profile_group(){
      var field_time = $('#field_date').html();
      document.getElementById('during_time').value = field_time;
      window.location.href = '/profile/group/?fieldEnName=' + $('#field_hidden').val() + '&during_time=' + field_time;
    }

    function choose_field(prefix, area){
      $("#field_hidden").val(area);
      cn_area = '';
      if(area=='finance')
          cn_area = '财经';
      else if(area=='media')
          cn_area = '媒体';
      else if(area=='sports')
          cn_area = '体育';
      else if(area=='fashion')
          cn_area = '时尚';
      else if(area=='culture')
          cn_area = '文化';
      else if(area=='education')
          cn_area = '教育';
      else if(area=='technology')
          cn_area = '科技';
      else if(area=='abroad')
          cn_area = '境外';
      else if(area=='entertainment')
          cn_area = '娱乐';
      else if(area=='university')
          cn_area = '高校微博';
      else if(area=='homeadmin')
          cn_area = '境内机构';
      else if(area=='abroadadmin')
          cn_area = '境外机构';
      else if(area=='homemedia')
          cn_area = '境内媒体';
      else if(area=='abroadmedia')
          cn_area = '境外媒体';
      else if(area=='folkorg')
          cn_area = '民间组织';
      else if(area=='lawyer')
          cn_area = '律师';
      else if(area=='politician')
          cn_area = '政府官员';
      else if(area=='mediaworker')
          cn_area = '媒体人士';
      else if(area=='activer')
          cn_area = '活跃人士';
      else if(area=='grassroot')
          cn_area = '草根';
      else if(area=='other')
          cn_area = '其它';
      $("#area_rank_method_choosen").text(cn_area);
      $("#area_rank_method_choosen").append(' <span class="caret"></span>');
      //close dropdown
      $("#area_rank_method_choosen").parent().removeClass('open');
      $("#area_rank_method_dropdown_menu").children().removeClass('active');
    }

  $(document).ready(function() {
    var field_time = $('#field_date').html();
    document.getElementById('during_time').value = field_time;
    $('#field_window_size_choosen').daterangepicker({
      ranges: {
         '1天': [all_startDate, all_startDate],
         '1周': [week_ago, all_startDate],
         //'1个月': [moment().startOf('month'), moment().endOf('month')],
         //'3个月': [moment().subtract('month', 3).startOf('month'), moment().subtract('month', 3).endOf('month')]
      },
      startDate: all_startDate,
      endDate: all_endDate,
      minDate: all_minDate,
      maxDate: all_maxDate
    },  
      function(start, end) {
        $('#field_window_size_choosen span').html(start.format('MMMM D日, YYYY') + ' - ' + end.format('MMMM D日, YYYY'));
      }
    );
  }
  );

  </script>
{% endblock script %}