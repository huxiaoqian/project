{% extends 'profile/ajax/ajax_layout.html' %}

{% block body %}
  
  <form class="form-inline">
      时间范围:
        <div class="btn-group">
          <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">1天<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li class="active"><a href="#" data-toggle="tab">1天</a></li>
            <li><a href="#" data-toggle="tab">1周</a></li>
            <li><a href="#" data-toggle="tab">1个月</a></li>
            <li><a href="#" data-toggle="tab">3个月</a></li>
          </ul>
        </div>
      <button class="btn btn-primary"><i class="icon-search"></i>计算</button>
  </form>
  <div class="btn-group" id="field_count">
    <button class="active btn">政务<span>20</span></button>
    <button class="btn btn-primary">体育<span>20</span></button>
    <button class="btn btn-success">财经<span>10</span></button>
    <button class="btn btn-info">娱乐<span>4</span></button>
    <button class="btn btn-warning">传媒<span>2</span></button>
    <button class="btn btn-inverse">社会<span>1</span></button>
  </div>
  <table class="table table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>昵称</th>
        <th>微博数</th>
        <th>粉丝数</th>
        <th>关注数</th>
        <th>领域</th>
      </tr>
    </thead>
    <tbody id="user_table">
    </tbody>
  </table>
  <div class="inputAppend"><a class="btn btn-small" href="#"><i class="icon-download-alt"></i> 导出</a></div>
  <div id="page-selection" class="pagination pagination-centered"></div>
  <script src="/static/js/profile/bootstrap.min.js"></script>
  <script src="/static/js/profile/jquery.bootpag.min.js"></script>
  <script>
    $(document).ready(function(){
      // init bootpag
      var total_page_number;
      $.ajax({
        url: "/profile/person_fri_fol/" + {{uid}} + "?page=1",
        dataType: 'json',   
        type: "GET",
        success: function (data) {
          var fields_result = data['fields'];
          $("#field_count").empty();
          var field_html = "";
          for(var i=0;i<fields_result.length;i+=1){
            var fieldName = fields_result[i][0];
            var fieldCount = fields_result[i][1];
            field_html += "<button class=\"btn btn-primary\">" + fieldName + "<span>" + fieldCount + "</span></button>";
          }
          $("#field_count").append(field_html);
          total_page_number = parseInt(data['pages']);
          var html = "";
          for(var i=0;i < data['users'].length;i += 1){
            user = data['users'][i];
            html += "<tr><td>" + user['id'] + "</td>";
            html += "<td>" + user['userName'] + "</td>";
            html += "<td>" + user['statusesCount'] + "</td>";
            html += "<td>" + user['followersCount'] + "</td>";
            html += "<td>" + user['friendsCount'] + "</td>";
            html += "<td>" + user['field'] + "</td></tr>";
          }
          $("#user_table").append(html);
          $('#page-selection').bootpag({
              total: total_page_number,
              maxVisible: 10
          }).on("page", function(event, /* page number here */ num){
               $("#user_table").empty();
               $.ajax({
                  url: "/profile/person_fri_fol/" + {{uid}} + "?page=" + num,
                  dataType: 'json',   
                  type: "GET",
                  success: function (data) {
                    var html = "";
                    for(var i=0;i < data['users'].length;i += 1){
                      user = data['users'][i];
                      html += "<tr><td>" + user['id'] + "</td>";
                      html += "<td>" + user['userName'] + "</td>";
                      html += "<td>" + user['statusesCount'] + "</td>";
                      html += "<td>" + user['followersCount'] + "</td>";
                      html += "<td>" + user['friendsCount'] + "</td>";
                      html += "<td>" + user['field'] + "</td></tr>";
                    }
                    $("#user_table").append(html);
                  }
                });
            });
        }
      });

    });
  </script>

{% endblock body %}

