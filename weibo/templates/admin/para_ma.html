<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>系统管理——参数设置</title>
<style type="text/css">
<!--
body { margin: 0px;padding: 0px;text-align: left;}
TD {FONT-SIZE: 12px; COLOR: #333;}
#daohang {BORDER-BOTTOM: #e2e2e2 1px solid;}


-->
</style>
<script src="/static/js/admin/jquery-1.9.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/js/admin/bootstrap.js"></script>
<script type="text/javascript" src="/static/js/admin/bootstrap.min.js"></script>
<link href="/static/css/admin/bootstrap.css" rel="stylesheet">
<link href="/static/css/admin/bootstrap-responsive.css" rel="stylesheet">
<link href="/static/css/admin/bootstrap.min.css" rel="stylesheet">
<link href="/static/css/admin/bootstrap-responsive.min.css" rel="stylesheet">
<style type="text/css" media="all">
ul{  
    list-style-type:none;  
    width:100%;
    padding: 0px;
    margin:0px;  
  }  
  
  </style>
 <style type="text/css">
  .onecity1{
    color:#FF0000;

  }
  .onecity2{
    color:black;
  }
  
    </style>

</head>

<body>

<SCRIPT>


function drop_menu(){<!-- 选择下拉菜单 -->
    var lis = document.getElementById("drop_ma");
    lis.style.display='block';
 }
 

function declear_all(){<!-- 全选 -->

      $(document).ready(function(){
           var divs=$("input[name='field_material']");
           for(var i = 0;i<divs.length;i++)
              divs[i].checked = true;
           });
      var lis = document.getElementById("drop_ma");
      lis.style.display='none'

 }
 

function declear_re(){<!-- 反选 -->
        
        $("[name='field_material']").each(function(){
     
   
             if(this.checked)
             {
                 this.checked = false;
             }
             else
             {
                 this.checked = true;
             }
   
           });
        var lis = document.getElementById("drop_ma");
        lis.style.display='none';

 }


</SCRIPT>

<div id="daohang" style="background:#58ACFA;">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="15%" align="center" ><a style="padding-left:20px;padding-top:10px;padding-bottom:10px;font-size: 18pt; color:#FFFFFF; font_weight:bold;text-decoration: none;">系统管理</a></td>
    <td width="75%">
    <ul class="nav" style="list-style:none;">
              
              <li class="" style=" float:left; padding-left:60px;width:100px;">
                <a href="/sysadmin/usermanage/"  align="center" style="padding-top:10px;padding-bottom:10px;font-size: 16pt; color:#FFFFFF; font_weight:bold;">用户管理</a>
              </li>
              <li class="" style=" float:left; padding-left:60px;width:100px;">
                <a href="/sysadmin/paraset/field/" align="center" style="padding-top:10px;padding-bottom:10px;font-size: 16pt; color:#2E2E2E; font_weight:bold; background:#F2F2F2;">参数设置</a>
              </li>             
              
    </td>
    <td width="10%" align="center" ><a style="CURSOR: hand;font-size: 14pt;color:black;text-decoration: none;" href="/sysadmin/logout">退出系统</a></td>
  </tr>
</table>
</div>

<div class="bs-docs-example">
    <div class="tabbable tabs-left" style="float:left;">
        <ul class="nav nav-tabs" style="padding-left:20px;padding-top:20px;float:left;">
          
          <li> <a id="User" href="/sysadmin/paraset/field/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >领域及话题管理</a></li>
          
          <li > <a id="Pass" href="/sysadmin/paraset/new/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >新词管理</a></li>

          <li> <a id="Bai" href="/sysadmin/paraset/white/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >情感词白名单管理</a></li>

          <li> <a id="Wai" href="/sysadmin/paraset/weight/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >博主权重指标管理</a></li>

          <li> <a id="Hei" href="/sysadmin/paraset/black/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >垃圾用户管理</a></li>

          <li> <a id="Media" href="/sysadmin/paraset/media/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#D8D8D8;width:200px;" >重要媒体管理</a></li>

          <li   class="active"> <a id="Material" href="/sysadmin/paraset/material/" align="center" style="font-size:12pt;color:#000000;padding-left:15px;padding-top:10px;background:#58ACFA;width:200px;" >微博素材管理</a></li>
        </ul>
    </div>
      <div class="tab-content" style="float:left;height:1000px;width:1050px;">


        <div class="tab-pane active" id="tab1" style="float:left;padding-left:30px;padding-top:50px;height:900px;width:1000px;">
        <p style="font-size:20pt;color:#FE642E;">微博素材管理</p>
        <div id="info" style="padding-left:50px;padding-top:20px;height:600px;width:800px;">
                <div id="manage" style="width:500px; height:70px;padding-left:25px;padding-top: 25px">
                    <div class="btn-group" >
                       <a class="btn dropdown-toggle" data-toggle="dropdown" href="#" style="width: 60px;" onClick="drop_menu()">
                         选择
                       <span class="caret"></span>
                      </a>
                       <ul class="dropdown-menu" id="drop_ma">
                    
                         <li><a href='#' onClick="declear_all()">全选</a></li>
                         <li><a href='#' onClick="declear_re()">反选</a></li>
                    </ul>
                    </div>
                    <a id="material_out" type="button" class="btn btn-warning" href="#">导出</a>
                    <button id='de_material' type="button" class="btn btn-danger">删除</button>
                </div>
                <div class="bs-docs-example">
                  <table class="table" id="material_table">
                    <thead>
                      <tr>                        
                        <th style="text-align:center">微博ID</th>
                        <th style="text-align:center">微博</th>
                        <th style="text-align:center">转发</th>
                        <th style="text-align:center">评论</th>
                        <th style="text-align:center">发布时间</th>
                        <th style="text-align:center">发布者</th>
                        <th style="text-align:center">选择</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for material in materials %}
                      <tr>
                        
                        <td style="text-align:center"><span class="num-id" style="font-size:15px;">{{material.weibo_id}}</span></td>
                        <td style="text-align:center"><span class="num-text" style="font-size:15px;">{{material.text}}</span></td>
                        <td style="text-align:center"><span class="num-repostsCount" style="font-size:15px;">{{material.repostsCount}}</span></td>
                        <td style="text-align:center"><span class="num-commentsCount" style="font-size:15px;">{{material.commentsCount}}</span></td>
                        <td style="text-align:center"><span class="num-uid" style="font-size:15px;">{{material.postDate}}</span></td>
                        <td style="text-align:center"><span class="num-postDate" style="font-size:15px;">{{material.uid}}</span></td>
                        <td style="text-align:center"><input type="checkbox" name="field_material" style="font-size:12pt;"/></td>
                      </tr>
                      {% endfor %}
                       
                  </tbody>   
                </table>
                <script>
                      $("#de_material").click(function() {
                          $("[name='field_material']").each(function(){
                              
                              if(this.checked)
                              {
                                  var fa = $(this).parent();
                                  var ne = $(fa).next();
                                  var f_id = $(ne).children().html();
                                  $.ajax({   
                                    type:"POST",  
                                    url:"/sysadmin/material_de",
                                    dataType: "json",
                                    async:false,
                                    data:{f_id : f_id},
                                    success: function(data){
                                      if( data =='Right'){
                                          alert("删除成功！");
                                        }
                                    }           
                                  });
                              }   
                          })
                          
                          location.reload();
                    });
                    function exportTableToCSV(filename) {
                        var n = 0;
                        $("[name='field_material']").each(function(){
                              if(this.checked)
                              {
                                  n = n + 1;
                              }
                        });
                        if(n > 0){
                            var ta = $("#material_table");
                            var $head = ta.find("thead");
                            var $r_head = $head.find("tr");

                            var tmpColDelim = String.fromCharCode(11); // vertical tab character
                            var tmpRowDelim = String.fromCharCode(0); // null character

                        
                            var colDelim = ",";
                            var rowDelim = "\r\n";

                            var c_head = $r_head.find("th");
                            var csv_head = '';
                            for(var count=0;count<c_head.length-1;count++){ 
                                if(count == (c_head.length-2)){
                                    csv_head = csv_head + c_head[count].innerHTML + rowDelim;
                                }
                                else{
                                    csv_head = csv_head + c_head[count].innerHTML + colDelim;
                                }
                
                            }

                            var csv = '';
                            $("[name='field_material']").each(function(){
                                if(this.checked)
                                {
                                    var rows = $(this).parent().parent();                              
                                    csv = csv + rows.map(function (i, row) {
                                        var $row = $(row),
                                        $cols = $row.find('td');

                                        return $cols.map(function (j, col) {
                                            var $col = $(col);
                                            if($col.find('input').length == 1){
                                                var text = '';
                                            }
                                            else{
                                                var text = $col.text();
                                            }
                                            return text.replace('"', '""'); // escape double quotes
                                        }).get().join(tmpColDelim);
                                    }).get().join(tmpRowDelim).split(tmpRowDelim).join(rowDelim).split(tmpColDelim).join(colDelim);
                                }
                            });

                            csv = csv_head + csv;

                        }
                        else{
                            var ta = $("#material_table");
                            var $head = ta.find("thead");
                            var $body = ta.find("tbody");
                            var $r_head = $head.find("tr");
                            var $rows = $body.find("tr");
                        
                            var tmpColDelim = String.fromCharCode(11); // vertical tab character
                            var tmpRowDelim = String.fromCharCode(0); // null character

                        
                            var colDelim = ",";
                            var rowDelim = "\r\n";

                        // Grab text from table into CSV formatted string
                            var c_head = $r_head.find("th");
                            var csv_head = '';
                            for(var count=0;count<c_head.length-1;count++){ 
                                if(count == (c_head.length-2)){
                                    csv_head = csv_head + c_head[count].innerHTML + rowDelim;
                                }
                                else{
                                    csv_head = csv_head + c_head[count].innerHTML + colDelim;
                                }
                
                            } 

                            csv = $rows.map(function (i, row) {
                                var $row = $(row),
                                $cols = $row.find('td');

                                return $cols.map(function (j, col) {
                                    var $col = $(col);
                                    if($col.find('input').length == 1){
                                        var text = '';
                                    }
                                    else{
                                        var text = $col.text();
                                    }
                                    return text.replace('"', '""'); // escape double quotes
                                }).get().join(tmpColDelim);
                            }).get().join(tmpRowDelim).split(tmpRowDelim).join(rowDelim).split(tmpColDelim).join(colDelim);
                            csv = csv_head + csv;
                        }
                        

                  // Data URI
                        csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);
                  //console.log(csvData);
                  //console.log(this);

                        $(this).attr({
                            'download': filename,
                            'href': csvData,
                            'target': '_blank'
                        });
                  }

                  $("a[id='material_out']").on('click', function (event) {
                      exportTableToCSV.apply(this, ['Material.csv']);
                      alert("素材导出成功！");
                  });
          </script>
        </div>       
        </div>
      </div>

      </div>

     </div>

</div>

    
</div>
</div>
</body>
</html>