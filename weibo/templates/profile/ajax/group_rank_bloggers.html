{% extends 'profile/ajax/ajax_layout.html' %}

{% block body %}     
  <form class="form-inline">
    排序标准<select class="span2" name="sort_type" id="sort_type">
        <option value="followers">粉丝数</option>
      </select>
    时间范围:
    <select class="span2" name="interval" id="interval">
      <option value="-1">最近一周</option>
    </select>
    前<input type="number" name="limit" value="1000" min="1" max="1000" class="span2" id="limit" disabled>条，
      每页<input type="text" id="countperpage" name="countperpage" value="8" class="span1" disabled>
      条结果
    <button type="button" class="btn btn-primary" id="rank" onclick="submit_form();return false;"><i class="icon-search"></i>排序</button>
  </form>
  <table class="table table-hover">
    <thead>
      <tr>
        <th>博主ID</th>
        <th>博主昵称</th>
        <th>微博数</th>
        <th>粉丝数</th>
        <th>关注数</th>
        <th>是否认证</th>
        <th>性别</th>
      </tr>
    </thead>
    <tbody id="user_table">
    </tbody>
  </table>
  <div class="inputAppend"><a class="btn btn-small" href="#"><i class="icon-download-alt"></i> 导出</a></div>
  <div id="page-selection" class="pagination pagination-centered"></div>
  <script src="/static/js/profile/bootstrap.min.js"></script>
  <script src="/static/js/profile/jquery.bootpag.min.js"></script>
  <script>
  var countperpage_args = 8;
  var limit_arg = 1000;
  var sex_kv = {'m': '男', 'f': '女'};
  var v_kv = {'true': '是', 'false': '否'};
  function submit_form(){
      var interval_arg = $("#interval")[0].value;
      var sort_arg = $("#sort_type")[0].value;
      getRankData(countperpage_args, interval_arg, sort_arg, limit_arg);
  }
  function getRankData(countperpage_args, interval_arg, sort_arg, limit_arg){
    var total_page_number;
    $.ajax({
        url: "/profile/group_rank/{{field}}?page=1&countperpage=" + countperpage_args + "&limit=" + limit_arg,
        dataType: 'json',   
        type: "GET",
        success: function (data) {
          total_page_number = parseInt(data['pages']);
          var html = "";
          for(var i=0;i < data['users'].length;i += 1){
            user = data['users'][i];
            html += "<tr><td>" + user['id'] + "</td>";
            html += "<td>" + user['userName'] + "</td>";
            html += "<td>" + user['statusesCount'] + "</td>";
            html += "<td>" + user['followersCount'] + "</td>";
            html += "<td>" + user['friendsCount'] + "</td>";
            html += "<td>" + v_kv[user['verified']] + "</td>";
            html += "<td>" + sex_kv[user['gender']] + "</td></tr>";
          }
          $("#user_table").empty();
          $("#user_table").append(html);
          $('#page-selection').bootpag({
              total: total_page_number,
              maxVisible: 10
          }).on("page", function(event, /* page number here */ num){
               $("#user_table").empty();
               $.ajax({
                  url: "/profile/group_rank/{{field}}?page=" + num + "&countperpage=" + countperpage_args + "&limit=" + limit_arg,
                  dataType: 'json',   
                  type: "GET",
                  success: function (data) {
                    var html = "";
                    for(var i=0;i < data['users'].length;i += 1){
                      user = data['users'][i];
                      html += "<tr><td>" + user['id'] + "</td>";
                      html += "<td>" + user['userName'] + "</td>";
                      html += "<td>" + user['statusesCount'] + "</td>";
                      html += "<td>" + user['followersCount'] + "</td>";
                      html += "<td>" + user['friendsCount'] + "</td>";
                      html += "<td>" + v_kv[user['verified']] + "</td>";
                      html += "<td>" + sex_kv[user['gender']] + "</td></tr>";
                    }
                    $("#user_table").append(html);
                  }
                });
            });
        }
      });
  }
  $(document).ready(function(){
      var interval_arg = $("#interval")[0].value;
      var sort_arg = $("#sort_type")[0].value;
      getRankData(countperpage_args, interval_arg, sort_arg, limit_arg);
  })
  </script>
{% endblock body %}

