{% extends 'profile/ajax/ajax_layout.html' %}

{% block body %}     
  <script src="/static/js/profile/highcharts.js"></script>
  <script src="/static/js/profile/exporting.js"></script>

  <script>
  function display_ori_repost_count(data){
    var chart = new Highcharts.Chart({
      chart: {
          renderTo: 'chartdiv_week_weibocount',
          type: 'line',
          marginRight: 100,
          marginBottom: 25
      },
      title: {
          text: '微博数量趋势',
          x: -20 //center
      },
      /*
      subtitle: {
          text: '原创转发对比',
          x: -20
      },*/
      xAxis: {
          categories: data['time'],//['2013-01-20', '2013-01-21', '2013-01-26', '2013-01-27', '2013-01-29', '2013-01-30', '2013-02-01', '2013-02-02', '2013-02-03', '2013-02-04', '2013-02-05', '2013-02-06', '2013-02-07', '2013-02-08', '2013-02-09', '2013-02-10', '2013-02-11', '2013-02-12', '2013-02-13', '2013-02-14', '2013-02-15', '2013-02-16', '2013-02-17', '2013-02-18', '2013-02-19', '2013-02-20', '2013-02-21', '2013-02-22', '2013-02-23', '2013-02-24', '2013-02-25', '2013-02-26', '2013-02-27'],//data[0],
          labels:{
            step:6 //3就是x轴显示的间隔
          }
      },
      yAxis: {
          title: {
              text: '微博条数（条）'
          },
          plotLines: [{
              value: 0,
              width: 1,
              color: '#808080',
              min: 0
          }]
      },
      tooltip: {
          formatter: function() {
                  return '<b>'+ this.series.name +'</b><br/>'+
                  this.x +': '+ this.y +'条';
          }
      },
      legend: {
          layout: 'vertical',
          align: 'right',
          verticalAlign: 'top',
          x: -10,
          y: 100,
          borderWidth: 0
      },
      series: [{
          name: '微博总数',
          data: data['count'],//[44, 37, 2, 3, 1, 1, 2, 4, 5, 3, 7, 9, 6, 7, 7, 3, 3, 9, 8, 5, 7, 2, 5, 4, 7, 2, 3, 5, 2, 2, 4, 3, 3],//data[1]//[7.0, 9, 9, 14, 18, 21, 25, 26, 23, 18, 13, 9]
      }, {
          name: '转发微博数',
          data: data['repost'],//[39, 30, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//data[2]//[2, 8, 5, 11, 17, 22, 24, 24, 20, 14, 8, 2]
      },{
          name: '原创微博数',
          data:  data['fipost'],//[5, 7, 0, 1, 1, 1, 2, 4, 5, 3, 7, 9, 6, 7, 7, 3, 3, 9, 8, 5, 7, 2, 5, 4, 7, 2, 3, 5, 2, 2, 4, 3, 3],//data[3]//[2, 8, 5, 11, 17, 22, 24, 24, 20, 14, 8, 2]
      }]
  });
}

  function display_week_weibocount(){
      $.ajax({
          url: "/profile/person_count/{{uid}}?interval=onemonth",
          dataType: 'json',   
          type: "GET",   
          success: function (data) {
            display_ori_repost_count(data);
          }
      });
  }

display_week_weibocount();
/*
  $(document).ready(function(){
    display_week_weibocount();
  })*/

  function submit_form(){
    var interval_arg = $("#interval")[0].value;
    $.ajax({
          url: "/profile/person_count/{{uid}}?interval=" + interval_arg,
          dataType: 'json',   
          type: "GET",   
          success: function (data) {
            $("#chartdiv_week_weibocount").empty();
            display_week_weibocount();
          }
      });
  }
  </script>
  <form class="form-inline">
      时间范围:
    <select class="span2" name="interval" id="interval">
      <option value="onemonth">1个月</option>
      <option value="oneweek">1周</option>
      <option value="threemonth">3个月</option>
    </select>
    <button type="button" class="btn btn-primary" onclick="submit_form();return false;"><i class="icon-search"></i>生成数量趋势图</button>
  </form>
  <div id="chartdiv_week_weibocount" style="min-width: 936px; height: 450px; margin: 0 auto"></div>
      

{% endblock body %}

