{% extends "propagate/base.html" %}
{% block title %}信息搜索{% endblock title%}
{% block head %}
  <link href="{{ url_for('static', filename='css/propagate/microblog.css') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/datarangepiker.css') }}" rel="stylesheet">
  <style>
    .WB_feed_datail, .WB_feed_type {
      width: 1000px;
    }
    .WB_info, .WB_text, .WB_detail {
      width: 950px;
    }
  </style>
  <script src="/static/js/admin/jquery-1.9.1.min.js" type="text/javascript"></script>
  

{% endblock head%}
{% block content %}
  <div class="container">
    <div class="row well">
    	<legend><strong>话题信息搜索</strong></legend>
    	<div class="inline">
        <ul>
    	    <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>关键字词:</b></font> <input type="text" class="span2" placeholder="请输入关键字" value="" role="textbox" name="keyword" id="topic_keywords">
    	    <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>关键用户: </b></font><input type="text" class="span2" placeholder="请输入用户" value="" role="textbox" name="keyuser" id="topic_keyusers">
          <!--开始时间: <input type="text" class="span2" placeholder="2013-01-01" data-date-format="yyyy-mm-dd" value="" role="textbox" name="beg_time">
          截止时间: <input type="text" class="span2" placeholder="2013-01-07" data-date-format="yyyy-mm-dd" value="" role="textbox" name="end_time">-->
          <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>时间范围:</b></font>
          <div id="reportrange_topic" class="btn dropdown-toggle">
            <i class="icon-calendar icon-large"></i>
            <span id="topic_time">September 20, 2013 - September 25, 2013</span>
            <b class="caret"></b>
          </div>
          <input type="hidden" name="r" value="1">
          <input type="submit" class="btn btn-primary" value = "搜索" id="search_topic">
        </ul>
    	</div>
      <hr>
      <ul id="TopicTab" class="nav nav-tabs">
        {% for field in field_topics %}
          {% if field.index == 1 %}
            <li class="active"><a href="#area_1" data-toggle="tab"><strong>{{field.field_name}}</strong></a></li>
          {% else %}
            <li><a href="#area_{{field.index}}" data-toggle="tab"><strong>{{field.field_name}}</strong></a></li>
          {% endif %}
        {% endfor %}  
        <li><a href="/sysadmin/" target="_blank"><i class="icon-cog"></i></a></li>
        <li><a href="/propagate/topics" ><strong>查看更多话题</strong></a></li>
      </ul>

      <div id="TopicTabContent" class="tab-content">
        {% for field in field_topics %}
          {% if field.index == 1 %}
            <div class="tab-pane fade active in" id="area_1">
              <ul class="inline">
                {% for topic in field.topics %}
                <li><input type="checkbox"> {{ topic }} </li>
                {% endfor %}
              </ul>
            </div>
          {% else %}
            <div class="tab-pane fade" id="area_{{field.index}}">
              <ul class="inline">
                {% for topic in field.topics %}
                <li><input type="checkbox"> {{ topic }} </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
	  <div class="row well">
      <legend><strong>微博信息搜索</strong></legend>
      <form class="form-inline" action = "/propagate/hot_status" method="post">
        <ul>
          <!--开始时间: <input type="text" class="span2" placeholder="2013-01-01" data-date-format="yyyy-mm-dd" value="" role="textbox" name="beg_time">
          截止时间: <input type="text" class="span2" placeholder="2013-01-07" data-date-format="yyyy-mm-dd" value="" role="textbox" name="end_time">-->
          <font color="#003366" face="Georgia, Times New Roman, Times, serif"><b>时间范围:</b></font>
          <div id="reportrange_single" class="btn dropdown-toggle">
            <i class="icon-calendar icon-large"></i>
            <span>September 20, 2013 - September 25, 2013</span> 
            <b class="caret"></b>
          </div>
          <input type="hidden" name="r" value="1">
          <input type="submit" class="btn btn-primary" value = "识别">
        </ul>
      </form>
      <hr>
    </div>
  </div> <!-- /container -->
{% endblock %}
{% block script %}
  <script src="{{ url_for('static', filename='js/identify/topic_selector.js') }}"></script>
  <script src="/static/js/identify/datarangepiker.js" type="text/javascript"></script>
  <script src="/static/js/identify/moment.js" type="text/javascript"></script>
   <script type="text/javascript">
    $(document).ready(function() {
  $('#reportrange_topic').daterangepicker({
      ranges: {
         'Today': [moment(), moment()],
         'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
         'Last 7 Days': [moment().subtract('days', 6), moment()],
         'Last 30 Days': [moment().subtract('days', 29), moment()],
         'This Month': [moment().startOf('month'), moment().endOf('month')],
         'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
      },
      startDate: moment().subtract('days', 29),
      endDate: moment()
    }, 
    function(start, end) {
  $('#reportrange_topic span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }
  );
  $('#reportrange_single').daterangepicker({
      ranges: {
         'Today': [moment(), moment()],
         'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
         'Last 7 Days': [moment().subtract('days', 6), moment()],
         'Last 30 Days': [moment().subtract('days', 29), moment()],
         'This Month': [moment().startOf('month'), moment().endOf('month')],
         'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
      },
      startDate: moment().subtract('days', 29),
      endDate: moment()
    }, 
    function(start, end) {
  $('#reportrange_single span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
    }
  );
});

$("#search_topic").click(function() {
  var time = $("#topic_time").html();
  var keyword = document.getElementById("topic_keywords").value;
  var keyuser = document.getElementById("topic_keyusers").value;
  window.location.href="/propagate/showresult/?keyword="+keyword+"&keyuser="+keyuser+"&time="+time;
});
</script>
{% endblock %}
